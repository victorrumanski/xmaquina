version: "3"

services:
  questdb:
    image: questdb/questdb
    container_name: questdb
    volumes:
      - ./questdb/conf/server.conf:/var/lib/questdb/conf/server.conf
    ports:
      - "9000:9000"
      - "9009:9009"
    networks:
      - "iotstack"
  
  mosquitto:
    image: eclipse-mosquitto
    container_name: mosquitto
    volumes:
      - ./mosquitto/config:/mosquitto/config
      - ./mosquitto/data:/mosquitto/data
    ports:
      - "1883:1883"
    links:
      - telegraf
    restart: always
    networks:
      - "iotstack"
  
  telegraf:
    image: telegraf
    container_name: telegraf
    env_file: questitto.env
    depends_on:
      - questdb
    links:
      - questdb
    volumes:
      - ./telegraf/telegraf.conf:/etc/telegraf/telegraf.conf:ro
    networks:
      - "iotstack"

  nginx:
    container_name: nginx
    image: nginx:1.13
    restart: always
    ports:
      - 80:80
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - questdb
    networks:
      - "iotstack"

networks:
  iotstack: